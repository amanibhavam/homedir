#!/usr/bin/env bash

function main {
  set -efu

  if [[ ! -d /home/linuxbrew ]]; then
    if [[ -x "$(type -P apt)" ]]; then
      sudo apt update
      sudo apt install -y make unzip python3-venv build-essential jq net-tools docker.io

      sudo install -d -o app -g app /home/linuxbrew
      git clone --depth 1 https://github.com/Homebrew/brew /home/linuxbrew/.linuxbrew
      git clone --depth 1 https://github.com/Homebrew/linuxbrew-core \
        /home/linuxbrew/.linuxbrew/Library/Taps/homebrew/homebrew-core

      /home/linuxbrew/.linuxbrew/bin/brew tap linuxbrew/xorg
    fi
  fi

  PATH="$HOME/.asdf/installs/bin:$PATH"

  mv homedir/.git .
  rm -rf homedir
  git reset --hard
  echo git@github.com:amanibhavam/dotfiles > .dotfiles-repo
  make update
  make upgrade
  make install
  source .bash_profile
  exec bash
}

main "$@"
