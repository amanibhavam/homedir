#!/usr/bin/env bash

function main {
  local nm_role

  if [[ -n "${VAULT_DEFAULT_ROLE:-}" ]]; then
    set -- "role=${VAULT_DEFAULT_ROLE}" "$@"
  fi

  if grep /docker/ /proc/$$/cgroup >/dev/null 2>&1; then
    set -- "port=18250" "listenaddress=0.0.0.0"
  fi

  exec vault login -method=oidc "$@"
}

source sub "$0" "$@"
