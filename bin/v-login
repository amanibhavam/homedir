#!/usr/bin/env bash

function main {
  local nm_role

  if [[ -n "${VAULT_DEFAULT_ROLE:-}" ]]; then
    set -- "role=${VAULT_DEFAULT_ROLE}" "$@"
  fi

  if (cgroup 2>/dev/null || true) | grep /docker/ >/dev/null; then
    set -- "port=18250" "listenaddress=0.0.0.0"
  fi

  exec vault login -method=oidc "$@"
}

source sub "$0" "$@"
